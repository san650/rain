<html>
  <style>
    .word {
      display: block;
      position: fixed;
      height: 50px;
    }

    .letter {
      display: inline-block;
      position: relative;
      width: 50px;
      height: 50px;
      font-size: 14px;
      font-weight: bold;
      background: white;
      color: #0A0A0A;
      border: 1px solid rgba(10,10,10, .5);
      border-radius: 3px;
      margin-right: 2px;
    }

    .word.yellow .letter {
      background: rgba(242,166,12, 1);
    }

    .word.red .letter {
      background: rgba(199,20,20, 1);
      color: #FFFCFC;
    }

    .word.blue .letter {
      background: rgba(7,73,135, 1);
      color: #FFFCFC;
    }

    .word.white .letter {
      background: rgba(255,252,252, 1);
    }

    .word.green .letter {
      background: rgba(77,178,81, 1);
    }

    .letter.hit {
      opacity: .5;
      transform: scale(.9);
    }

    .letter::before {
      font-size: 2rem;
      margin: 5px 2px 0 0;
      display: block;
      width: 100%;
      text-align: center;
      content: attr(data-symbol);
    }

    .letter::after {
      position: absolute;
      bottom: 1px;
      right: 7px;
      display: block;
      content: attr(data-symbol-value);
    }

    .rain {
      animation-name: hit, rain;
      animation-iteration-count: 1;
      animation-direction: normal; /* we can play with reverse as a nice effect */
      animation-timing-function: linear;
      animation-fill-mode: forwards;
      animation-play-state: paused, running;
    }

    .word.hit {
      animation-play-state: running, paused;
    }

    .container:not(:focus) .rain {
      animation-play-state: paused, paused;
    }

    .d0 { animation-duration: .5s, 10s; }
    .d1 { animation-duration: .5s, 11s; }
    .d2 { animation-duration: .5s, 12s; }
    .d3 { animation-duration: .5s, 13s; }
    .d4 { animation-duration: .5s, 14s; }
    .d5 { animation-duration: .5s, 15s; }
    .d6 { animation-duration: .5s, 16s; }
    .d7 { animation-duration: .5s, 17s; }
    .d8 { animation-duration: .5s, 18s; }
    .d9 { animation-duration: .5s, 19s; }

    @keyframes rain {
      from { transform: translate(0, 0); }
      to { transform: translate(0, 100vh); }
    }

    @keyframes hit {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    html, body, .container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      background: #FFFCFC;
    }

    .osd {
      position: fixed;
      right: 150px;
      top: 10px;
      font-size: 18px;
      font-style: bold;
    }

    .container:focus::after {
      display: none;
    }

    .container::after {
      color: red;
      content: "CLICK THE PAGE TO BE ABLE TO PLAY!";
      font-size: 2rem;
    }

    .shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
    }

    @keyframes shake {
      10%, 90% {
        transform: translate3d(-1px, 0, 0);
      }

      20%, 80% {
        transform: translate3d(2px, 0, 0);
      }

      30%, 50%, 70% {
        transform: translate3d(-4px, 0, 0);
      }

      40%, 60% {
        transform: translate3d(4px, 0, 0);
      }
    }
  </style>
  <body>
    <div id="canvas" class="container" tabindex=0>
    </div>
    <div class="osd">
      <span style="display: none">Missed: <span id="missed">0</span></span>
      <span>Points: <span id="hit">0</span></span>
    </div>

    <script>
      var container = document.getElementById('canvas');

      function createWord(word) {
        var span = document.createElement('span');
        span.setAttribute('data-word', word.value);
        span.setAttribute('data-value', word.letters.reduce((sum, letter) => sum + letter.value, 0));
        span.style.left = word.x;
        span.classList.add('word');
        span.classList.add('rain');
        span.classList.add(word.color);
        span.classList.add('d' + word.duration);

        word.letters.forEach((letter) => createLetter(span, letter));

        container.appendChild(span);
      }

      function createLetter(parent, letter) {
        var span = document.createElement('span');
        span.setAttribute('data-symbol', letter.symbol);
        span.setAttribute('data-symbol-value', letter.value);
        span.classList.add('letter');

        parent.appendChild(span);
      }

      function random(n) {
        return Math.floor(Math.random() * n);
      }

      function randomPercentage() {
        // Use less than 100 so it doesn't overflow on the right
        return String(Math.min(random(100), 60)) + '%';
      }

      function randomDuration() {
        return random(10);
      }

      var LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      var VALUES =  [1,3,3,2,1,4,2,4,1,8,5,1,3,1,1,3,10,1,1,1,1,4,4,8,4,10];
      var COLORS = [
        "blue",
        "green",
        "red",
        "white",
        "yellow",
      ];
      var WORDS = [
        "black",
        "blue",
        "green",
        "grey",
        "magenta",
        "maroon",
        "olive",
        "orange",
        "pink",
        "red",
        "violet",
        "white",
        "yellow",
      ];

      function randomColor() {
        var index = random(COLORS.length);
        return COLORS[index];
      }

      function randomWord() {
        var index = random(WORDS.length);
        return WORDS[index];
      }

      function valueForSymbol(symbol) {
        var index = LETTERS.indexOf(symbol);
        return VALUES[index];
      }

      function deleteElement(element) {
        var container = element.parentElement;
        container.removeChild(element);
      }

      function toWord(word) {
        word = word.toUpperCase();

        var letters = word.split("").map(letter => ({
          symbol: letter,
          value: valueForSymbol(letter),
        }));

        return {
          duration: randomDuration(),
          letters: letters,
          value: word,
          color: randomColor(),
          x: randomPercentage(),
        };
      }

      window.setInterval(function generator() {
        if (!document.hasFocus()) {
          return;
        }

        createWord(toWord(randomWord()));
      }, 2000);

      var current = "";
      var missedCount= 0;
      var hitCount = 0;
      var missedElement = document.getElementById('missed');
      var hitElement = document.getElementById('hit');

      function missed() {
        missedCount++;
        missedElement.innerText = missedCount;

        Array.from(
          document.querySelectorAll('.hit:not(.word)')
        ).forEach((element) => element.classList.remove('hit'));
        container.classList.add('shake');
      }

      function hit(value) {
        hitCount += value;
        hitElement.innerText = hitCount;
      }

      // cleanup
      container.addEventListener("animationend", function(event) {
        switch(event.animationName) {
          case "rain":
            missed();
            deleteElement(event.target);
            container.classList.add('shake');
            break;
          case "hit":
            deleteElement(event.target);
            break;
          case "shake":
            container.classList.remove('shake');
            break;
        }
      }, false);

      // keyboard
      container.addEventListener("keypress", function(event) {
        if (container.matches('.shake')) {
          return;
        }

        var key = event.key.toUpperCase();

        current += key;

        var word = document.querySelector('[data-word^="' + current + '"]:not(.hit)');
        var letter;

        if (word) {
          if (word.matches('[data-word="' + current + '"]:not(.hit)')) {
            hit(Number(word.getAttribute('data-value')));
            word.classList.add('hit');
            current = "";
          } else {
            letter = word.querySelector('.letter[data-symbol="' + key + '"]:not(.hit)');

            if (letter) {
              letter.classList.add('hit');
            } else {
              current = "";
              missed();
            }
          }
        } else {
          current = "";
          missed();
        }
      }, false);

      container.focus();
    </script>
  </body>
</html>
